<configuration xmlns:patch="http://www.sitecore.net/xmlconfig/" xmlns:role="http://www.sitecore.net/xmlconfig/role/" xmlns:security="http://www.sitecore.net/xmlconfig/security/">
  <sitecore>
    <itemManager defaultProvider="default">
      <providers>
        <clear />
        <add name="default" type="Sitecore.Data.Managers.ItemProvider, Sitecore.Kernel">
          <patch:delete />
        </add>
        <add name="default" type="SitecoreAdvancedCaching.Providers.ItemTrackingProvider, SitecoreAdvancedCaching"/>
      </providers>
    </itemManager>
    <settings>
      <setting name="DatasourceRootsToIndex" value="/sitecore/content"/>
      <setting name="IndexName" value="sitecore_web_index"/>
    </settings>
    <pipelines>
      <mvc.renderRendering>
        <processor
          type="SitecoreAdvancedCaching.Pipelines.RenderingContextProcessor, SitecoreAdvancedCaching"
          patch:before="processor[@type='Sitecore.Mvc.Pipelines.Response.RenderRendering.InitializeProfiling, Sitecore.Mvc']" />
        <processor 
          type="SitecoreAdvancedCaching.Cache.GenerateCacheKeyWithUID, SitecoreAdvancedCaching" 
          patch:before="processor[@type='Sitecore.Mvc.Pipelines.Response.RenderRendering.AddRecordedHtmlToCache, Sitecore.Mvc']" />
      </mvc.renderRendering>
    </pipelines>
    <contentSearch>
      <indexConfigurations>
        <defaultSolrIndexConfiguration type="Sitecore.ContentSearch.SolrProvider.SolrIndexConfiguration, Sitecore.ContentSearch.SolrProvider">
          <documentOptions type="Sitecore.ContentSearch.SolrProvider.SolrDocumentBuilderOptions, Sitecore.ContentSearch.SolrProvider">
            <fields hint="raw:AddComputedIndexField">
              <!-- <field fieldName="ItemHasLayout" returnType="bool" storageType="yes" indexType="untokenized"> -->
              <!--   SitecoreAdvancedCaching.Search.ItemHasLayoutComputedField, SitecoreAdvancedCaching -->
              <!-- </field> -->
              <!-- <field fieldName="ItemRenderings" returnType="string" storageType="yes" indexType="untokenized"> -->
              <!--   SitecoreAdvancedCaching.Search.ItemRenderingsComputedField, SitecoreAdvancedCaching -->
              <!-- </field> -->
              <!-- <field fieldName="ItemDatasources" returnType="string" storageType="yes" indexType="untokenized"> -->
              <!--   SitecoreAdvancedCaching.Search.ItemDatasourcesComputedField, SitecoreAdvancedCaching -->
              <!-- </field> -->
              <field fieldName="PublishingTimestamp" returnType="string" storageType="yes" indexType="untokenized">
                SitecoreAdvancedCaching.Search.PublishingTimestampComputedField, SitecoreAdvancedCaching
              </field>
              <!-- <field fieldName="CachingRules" returnType="string" storageType="yes" indexType="untokenized"> -->
              <!--   SitecoreAdvancedCaching.Search.ItemCachingRulesComputedField, SitecoreAdvancedCaching -->
              <!-- </field> -->
            </fields>
          </documentOptions>
        </defaultSolrIndexConfiguration>
      </indexConfigurations>
    </contentSearch>
    <events>
      <event name="publish:startPublishing">
        <handler type="SitecoreAdvancedCaching.Events.PublishingStartEvent, SitecoreAdvancedCaching" method="SetPublishingStartTimestamp"/>
      </event>
      <event name="publish:end">
        <handler type="Sitecore.Publishing.HtmlCacheClearer, Sitecore.Kernel" method="ClearCache">
          <patch:delete />
        </handler>
      </event>
      <event name="indexing:end">
        <handler type="SitecoreAdvancedCaching.Events.IndexingEndEvent, SitecoreAdvancedCaching" method="CaclculateRenderingCachesToClear"/>
      </event>
      <!-- <event name="caching"> -->
      <!--   <handler type="SitecoreAdvancedCaching.Events.HtmlCacheClearingEvent, SitecoreAdvancedCaching" method="ClearHtmlCache"/> -->
      <!-- </event> -->
    </events>
  </sitecore>
</configuration>